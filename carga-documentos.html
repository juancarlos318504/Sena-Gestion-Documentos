<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/styles.css">

    

    <title>Sistema de Gestión Inteligente de Documentos Digitales</title>
  </head>
  <body>


    <div id="header" class="container">
        <!-- Header -->
        <div class="row justify-content-center align-items-center py-2 py-md-4 px-4 px-sm-2">
            <div class="col-12 col-sm-3 col-lg-4 text-center text-sm-left pb-3 pb-sm-0">
                <img src="img/logoSena.png" class="d-inline-block site-logo" >
            </div>
            <div class="col-12 col-sm-6 col-lg-4 text-center">
              <h1 class="site-title">Sistema de Gestión Inteligente de Documentos Digitales</h1>
            </div>
            <div class="col-12 col-sm-3 col-lg-4 text-center text-sm-right">
              <img src="img/logoMintrabajo.png" class="logoMintrabajo d-none d-sm-inline-block" >
            </div>  
        </div>

    </div>


    
    <!-- Contenido -->
    <div class="py-5 bg-light">

      <div class="container">

        <!-- Titulo - Perfil usuario -->
        <div class="row justify-content-center px-4">
          <div class="col-12 col-md-6 order-2 order-md-1">
            <h5 id="title-carga" class="mb-5 text-center text-md-left titulos">Carga de documentos digitales</h4>
            <h5 id="title-proceso" class="mb-5 text-center text-md-left titulos d-none">Proceso de documentos digitales</h4> 
            <h5 id="resultado-proceso" class="mb-5 text-center text-md-left titulos d-none">Resultado carga de documentos digitales</h4> 
          </div>
          <div class="col-12 col-md-6 order-1 order-md-2 text-center text-md-right mb-2 mb-md-0">
            <img src="img/profile-user.png">
            <span class="align-middle pl-1" >Modulo Aspirante</span>
          </div>
        </div>


        <!-- Paso 1 -->
        <div id="paso-1" class="row justify-content-center pasos mt-3 mb-2">
          <div class="col-12 col-md-7 py-2 px-4">

            <div class="form-group my-2">
              <label for="tipo-doc">Tipo de documento:</label>
              <select class="form-control my-fields" name="tipo-doc" id="tipo-doc">
                <option value="" >Seleccione</option>
                <option value="Documento de identidad" >Documento de identidad</option>
                <option value="Documento de estudios" >Documento de estudios</option>
                <option value="Pruebas de estado Icfes" >Pruebas de estado Icfes</option>
                <option value="Compromiso del aprendiz" >Compromiso del aprendiz</option>
              </select>
            </div>
            <div class="form-group mt-4">
              <label for="Documento" class="d-block">Archivo:</label>
              <input type="file" name="documento" id="documento" class="my-fields">
              <small class="text-muted d-block pl-2">Solo se admiten archivos JPG y PNG.</small>

              
              

            </div>
  
            <div class="text-center mt-5">
              <button id="btn-subir-archivo" class="btn btn-primary font-weight-bold mx-1 mb-3 mb-lg-0" >Subir Archivo</button>
              <button id="paso1-ver-docs-validados" class="btn btn-primary d-none mx-3 mb-1 mb-lg-0">Ver archivos validados</button>
            </div>
            
          </div>
        </div>



        <!-- Paso 2 -->
        <div id="paso-2" class="row justify-content-center d-none pasos mt-3 mb-5">
          <div class="col-12 col-md-7 py-2 text-center">
            <div class="card text-center mx-auto">
              <div class="card-body">
                <h5 class="card-title">Subiendo Archivo</h5>
                <div class="my-5">
                  <img src="img/subir-archivo.png" class="my-3">
                  <p class="card-text font-weight-bold archivo-actual">archivo.jpg</p>
                </div>
                <p class="card-text my-4">Espera mientras se sube el archivo.</p>
              </div>
            </div>
          </div>
        </div>



        <!-- Paso 3 - VALIDAR ARCHIVO -->
        <div id="paso-3" class="row justify-content-center d-none pasos my-5">
          <div class="col-12 col-md-6 py-2 px-5 px-md-2 text-center">
            
            <div id="archivo-por-validar">
              <p> Archivo a validar: </p>
              <ul class="list-group mt-4">
                <li class="list-group-item d-flex justify-content-between lh-condensed">
                  <div>
                    <strong class="tipo-archivo">Documento de identidad</strong>
                  </div>
                  <span class="text-muted archivo-actual">archivo.jpg</span>
                </li>
              </ul>
            </div>
          </div>
          <div class="w-100"></div>
          <div class="col-12 col-md-7 py-2 mt-5 text-center">
            <button id="btn-validar-archivo" class="btn btn-primary font-weight-bold " >Validar tratamiento digital de imagen (TDI)</button>
          </div>
        </div>



        <!-- Validando -->
        <div id="validando-archivo" class="row justify-content-center d-none pasos mt-3 mb-5">
          <div class="col-12 col-md-7 py-2 text-center">
            <div class="card text-center mx-auto">
              <div class="card-body">
                <h5 class="card-title">Validando documento</h5>
                <div class="my-5">
                  <img src="img/loading.gif" class="my-3">
                  <p class="card-text font-weight-bold archivo-actual">archivo.jpg</p>
                </div>
                <p class="card-text my-4">Espera mientras se valida el archivo.</p>
              </div>
            </div>
          </div>

        </div>


        <!-- Resultado validacion OK -->
        <div id="resultado-validacion-ok" class="row justify-content-center d-none pasos mt-3 mb-5">
          <div class="col-12 col-md-7 py-2 text-center">
            <div class="card text-center mx-auto">
              <div class="card-body">
                <h5 class="card-title">Documento Validado Correctamente</h5>
                <img src="img/correcto.png" class="my-3" style="width: 100px;">
                <p class="card-text archivo-actual">archivo.jpg</p>
                <div class="alert alert-primary mt-4 mb-4" role="alert" style="max-width: 248px; margin: 0 auto;">
                  <strong>Validación TDI Aprobada</strong>
                </div>
                <button id="aceptar-resultado" class="btn btn-primary">Aceptar</button>
              </div>
            </div>
          </div>
        </div>

        
        <!-- Resultado validacion FAIL -->
        <div id="resultado-validacion-fail" class="row justify-content-center d-none pasos mt-3 mb-5">
          <div class="col-12 col-md-7 py-2 text-center">
            <div class="card text-center mx-auto">
              <div class="card-body">
                <h5 class="card-title">Documento No Validado</h5>
                <img src="img/error.png" class="my-3" style="width: 100px;">
                <p class="card-text archivo-actual">archivo.jpg</p>
                <div class="alert alert-danger mt-4 mb-4" role="alert" style="max-width: 248px; margin: 0 auto;">
                  <strong>Validación TDI No Aprobada</strong>
                </div>

                <div class="alert alert-warning mb-5" role="alert">
                  <h5 class="alert-heading">Algunas recomendaciones</h5>
                  <ul>
                    <li>Escanear el documento original nuevamente.</li>
                    <li>Colocar el documento sobre una superficie plana y sin arrugas.</li>
                    <li>Tener en cuenta que solo se admite archivos JPG y PNG.</li>
                  </ul>
                </div>

                <button id="volver-subir-page" class="btn btn-primary">Volver a subir documento</button>
                <button id="mostrar-listado-docs" class="btn btn-primary d-none">Ver archivos validados</button>
              </div>
            </div>
          </div>
        </div>








        <!--  LISTADO DE ARCHIVOS -->
        <div id="paso-listado" class="row justify-content-center d-none pasos my-5">
          <div class="col-12 col-md-6 py-2 px-5 px-md-2 text-center">
            
            <p> Archivos validados: </p>
            <ul id="listado-archivos" class="list-group mt-4" archivos="" flag="true">

              <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div><strong>El archivo</strong></div>
                <span class="text-muted">12%</span>
              </li>


            </ul>

            
          </div>

          <div class="w-100"></div>

          <div class="col-12 col-md-7 py-2 mt-4 text-center">
            <button id="btn-subir-otro" class="btn btn-primary font-weight-bold mx-1 mb-3 mb-lg-0" >Subir otro archivo</button>
            <button id="btn-matricularme" class="btn btn-success font-weight-bold mx-1 mb-3 mb-lg-0" >Enviar para matricularme</button>  
          </div>
          
          
        </div>


        <!-- Imagen OpenCv a validar-->
        <div class="d-none">
            <img id="imageSrc" alt="No Image" class=""/>
        </div>




      </div>




    </div>





    <!-- Botones de avance -->
    <div id="footer" class="container">
      <div class="row py-4">
        <div class="col-6 text-center text-lg-left">
          <!--<a id="btn-atras" href="index.html" class="btn btn-primary">Atrás</a>-->
        </div>
        <div class="col-6 text-center text-lg-right">
          <!--<a href="#" class="btn btn-primary">Siguiente</a>-->
        </div>
      </div>
    </div>









    <!-- JavaScript -->
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/code.js"></script>

    <script async src="js/opencv.js"></script>

    <script>
      function validarImg(){
        let respuesta = "null";
        let imgElement = document.getElementById('imageSrc');
        let inputElement = document.getElementById('documento');

        let src = cv.imread(imgElement);
        let dst = new cv.Mat();
        let men = new cv.Mat();
        let menO = new cv.Mat();
        cv.cvtColor(src, src, cv.COLOR_RGB2GRAY, 0);
        // You can try more different parameters
        var t = cv.Laplacian(src, dst, cv.CV_64F, 1, 1, 0, cv.BORDER_DEFAULT);
        console.log(t,cv.meanStdDev(dst, menO, men),menO.data64F[0], men.data64F[0]);
        if(men.data64F[0] > 10){
          respuesta = "not blur";
        }else{
          respuesta = "blur";
        }
        //cv.imshow('canvasOutput', dst);
        src.delete(); dst.delete();

        $("#resValidacion").attr("res",respuesta);
        return respuesta;
            
      }

    </script>
    
  </body>
</html>